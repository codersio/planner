import{W as A,r as h,j as e}from"./app-BOMB9RPx.js";import{H as T,N as R}from"./Nav-B4LcHgH8.js";import{C as g}from"./choices.min-CtdodhxI.js";import{N as $}from"./notyf.min-DLu_xjpT.js";import"./iconBase-CO2Y0hZ5.js";import"./index-DFW5HbVH.js";import"./index-rLyOIo_R.js";const n=new $,G=({employees:p,projects:c,taskcategory:y,user:v,user_type:N,notif:b})=>{const{data:a,setData:d,post:E,errors:j}=A({task_name:"",estimate_hours:"",sdate:"",edate:"",employee_id:[],employee_hours:{},status:"",project_id:c.length>0?c[0].id:""}),x=h.useRef(null),f=h.useRef(null);h.useEffect(()=>{const t=new g(x.current,{removeItemButton:!0,searchEnabled:!0}),r=new g(f.current,{removeItemButton:!0,searchEnabled:!0});return()=>{t.destroy(),r.destroy()}},[]);const i=t=>{const{name:r,value:s}=t.target;d(l=>({...l,[r]:s}))},w=t=>{const r=Array.from(t.target.selectedOptions,s=>s.value);d("employee_id",r),d(s=>{const l={...s.employee_hours};return r.forEach(o=>{l[o]||(l[o]="")}),{...s,employee_hours:l}})},C=(t,r)=>{d(s=>({...s,employee_hours:{...s.employee_hours,[t]:r}}))},F=async t=>{t.preventDefault();const r=parseInt(a.project_id),s=c.find(o=>o.id===r);if(!s){n.error("Selected project not found.");return}const l=parseFloat(a.estimate_hours);try{const o=await axios.get(`/project-tasks/${r}/total-hours`),k=parseFloat(o.data.total_hours)+l,_=parseFloat(s.estimate_time);if(k>_){n.error(`Total hours exceed the allowed limit for the project. Maximum allowed: ${_} hours.`);return}E("/task-store",{data:a,onSuccess:()=>{n.success("Task created successfully with notification sent.")},onError:m=>{typeof m=="object"&&m!==null?Object.entries(m).forEach(([P,u])=>{Array.isArray(u)?u.forEach(H=>n.error(H)):n.error(u)}):n.error("An unexpected error occurred.")}})}catch{n.error("Failed to validate project hours. Please try again later.")}},S=a.task_name.replace(/\u00A0/g," ").trim();return e.jsxs("div",{className:"w-[85.2%] ml-[12rem]",children:[e.jsx(T,{user:v,notif:b}),e.jsx(R,{user_type:N}),e.jsx("div",{className:"flex flex-col gap-6",children:e.jsx("div",{className:"flex items-center justify-between"})}),e.jsx("div",{className:"p-3 table-section",children:e.jsxs("form",{onSubmit:F,className:"px-[8rem] grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"project_id",children:"Project Name"}),e.jsxs("select",{ref:x,className:"w-full rounded-lg",name:"project_id",value:a.project_id,onChange:i,children:[e.jsx("option",{value:"",children:"Select project"}),c.map(t=>e.jsx("option",{value:t.id,children:t.title},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"task_name",children:"Task Name"}),e.jsxs("select",{className:"w-full rounded-lg",name:"task_name",value:a.task_name,onChange:i,children:[e.jsx("option",{value:"",children:"Select"}),y.map(t=>e.jsx("option",{value:t.tname,children:t.tname},t.id))]}),j.name&&e.jsx("div",{children:j.name})]}),e.jsx("div",{children:S!=="NON-BILLABLE"&&e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:"estimate_hours",children:"Estimate Hours"}),e.jsx("input",{className:"w-full rounded-lg",id:"estimate_hours",name:"estimate_hours",type:"number",value:a.estimate_hours,onChange:i})]})}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"employee_id",children:"Employee Assign"}),e.jsxs("select",{ref:f,multiple:!0,name:"employee_id",id:"employee_id",value:a.employee_id,onChange:w,className:"w-full rounded-lg",children:[e.jsx("option",{value:"",children:"Select Employee"}),p.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),a.employee_id.length>0&&e.jsx("div",{className:"col-span-2",children:a.employee_id.map(t=>{var r;return e.jsxs("div",{children:[e.jsxs("label",{htmlFor:`employee_hours_${t}`,children:["Hours for ",(r=p.find(s=>s.id===t))==null?void 0:r.name]}),e.jsx("input",{className:"w-full rounded-lg",type:"number",id:`employee_hours_${t}`,name:`employee_hours_${t}`,value:a.employee_hours[t]||"",onChange:s=>C(t,s.target.value)})]},t)})}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"sdate",children:"Start Date"}),e.jsx("input",{className:"w-full rounded-lg",id:"sdate",name:"sdate",type:"date",value:a.sdate,onChange:i,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edate",children:"End Date"}),e.jsx("input",{className:"w-full rounded-lg",id:"edate",name:"edate",type:"date",value:a.edate,onChange:i,required:!0})]}),e.jsx("button",{type:"submit",className:"bg-blue-600 p-2 rounded-md text-white w-[30%]",children:"Create"})]})})]})};export{G as default};
