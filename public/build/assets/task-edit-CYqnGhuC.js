import{r as h,W as N,j as t}from"./app-CcCqTZT3.js";import{H as w,N as S}from"./Nav-DXO1xuTL.js";import{N as k}from"./notyf.min-DLu_xjpT.js";import{M as $}from"./index-B8hA4fv0.js";import"./index-DXmVpITn.js";const x=new k,H=({project:l,employees:u,user:v,user_type:j,notif:g})=>{const[c,F]=h.useState(l.assignments.map(e=>e.employee_id)||[]),[o,f]=h.useState(l.assignments.reduce((e,s)=>(e[s.employee_id]=s.employee_hours||"",e),{})),[a,_]=h.useState({}),{data:i,setData:d,post:y}=N({task_name:l.task_name||"",estimate_hours:l.estimate_hours||"",estimate_budget:l.estimate_budget||"",sdate:l.sdate||"",edate:l.edate||"",employee_id:c||[],employee_hours:o||{}}),p=40,E=e=>{e.preventDefault();const s=Object.values(o).reduce((r,n)=>r+parseFloat(n||0),0);if(s>parseFloat(i.estimate_hours)){x.error(`Total employee hours (${s} hours) exceed the task estimate of ${i.estimate_hours} hours.`);return}y(`/task-update/${l.id}`,{onSuccess:()=>{x.success("Task updated successfully")}})},b=(e,s)=>{const r=parseFloat(s),n={...o,[e]:s};if(r>p)_(m=>({...m,[`employee_hours_${e}`]:`Estimated hours for this employee cannot exceed ${p} hours.`}));else{const m={...a};delete m[`employee_hours_${e}`],_(m)}f(n),d("employee_hours",n)};return t.jsxs("div",{className:"w-[85.2%] ml-[12rem]",children:[t.jsx(w,{user:v,notif:g}),t.jsx(S,{user_type:j}),t.jsxs("form",{onSubmit:E,className:"px-[8rem] grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"title",children:"Title:"}),t.jsx("input",{className:"w-full rounded-lg",type:"text",id:"title",value:i.task_name,onChange:e=>d("task_name",e.target.value)}),a.task_name&&t.jsx("div",{children:a.task_name})]}),l.task_name!=="NON-BILLABLE"&&t.jsxs("div",{children:[t.jsx("label",{htmlFor:"estimate_hours",children:"Estimate Time:"}),t.jsx("input",{className:"w-full rounded-lg",type:"text",id:"estimate_hours",value:i.estimate_hours,onChange:e=>d("estimate_hours",e.target.value)}),a.estimate_hours&&t.jsx("div",{children:a.estimate_hours})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"start_date",children:"Start Date:"}),t.jsx("input",{className:"w-full rounded-lg",type:"date",id:"sdate",value:i.sdate,onChange:e=>d("sdate",e.target.value)}),a.sdate&&t.jsx("div",{children:a.sdate})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"end_date",children:"End Date:"}),t.jsx("input",{className:"w-full rounded-lg",type:"date",id:"edate",value:i.edate,onChange:e=>d("edate",e.target.value)}),a.edate&&t.jsx("div",{children:a.edate})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"employees",children:"Assign Employees:"}),t.jsx($,{options:u,selectedValues:u.filter(e=>c.includes(e.id)),onSelect:(e,s)=>{d("employee_id",[...i.employee_id,s.id])},onRemove:(e,s)=>{d("employee_id",i.employee_id.filter(r=>r!==s.id))},displayValue:"name",className:"w-full rounded-lg"}),a.employee_id&&t.jsx("div",{children:a.employee_id})]}),i.employee_id.map(e=>{var s;return t.jsxs("div",{children:[t.jsxs("label",{htmlFor:`estimate_time_${e}`,children:["Estimate Time for ",(s=u.find(r=>r.id===e))==null?void 0:s.name,":"]}),t.jsx("input",{type:"text",id:`employee_hours_${e}`,value:o[e]||"",onChange:r=>b(e,r.target.value),className:"w-full rounded-lg"}),a[`employee_hours_${e}`]&&t.jsx("div",{children:a[`employee_hours_${e}`]})]},e)}),t.jsx("br",{}),t.jsx("button",{type:"submit",className:"bg-blue-600 p-2 rounded-md text-white w-[30%]",children:"Save"})]})]})};export{H as default};
