import{r as l,b as D,j as e}from"./app-CcCqTZT3.js";import{H as Q,N as U,B as V}from"./Nav-DXO1xuTL.js";import{u as X}from"./index-CofMn_tm.js";import{h as n,C as Z}from"./index-C6VdMYqz.js";import{F as I}from"./index-DXmVpITn.js";import"./index-Ct86Fiit.js";const le=({leave:k,initialWeekData:ee,user:v,user_type:N,holiday:M})=>{l.useState(new Date);const[S,p]=l.useState(!1),[c,f]=l.useState([]),[W,w]=l.useState([]),[y,C]=l.useState({}),{data:T,setData:m,post:_,errors:te}=X({timesheets:[]});l.useEffect(()=>{D.get("/getProjectTasks").then(s=>{console.log("Full Response:",s);const t=s.data||{};C(t),w(Object.keys(t).map(a=>({id:a,project_name:t[a].project_name})))}).catch(s=>console.error("Error fetching project tasks:",s))},[]);const[d,Y]=l.useState(n().startOf("isoWeek").format("YYYY-MM-DD"));l.useEffect(()=>{E(d)},[d]);const E=s=>{D.get(`/timesheets/${s}`).then(t=>{const a=t.data.map(r=>({...r,date:r.date||x(0)}));a.length===0?p(!0):(p(!1),f(a),m("timesheets",a))}).catch(t=>{console.error("There was an error fetching the timesheet data!",t)})},x=s=>n(d).startOf("isoWeek").add(s,"days").format("YYYY-MM-DD"),O=()=>{Y(n(d).subtract(1,"weeks").format("YYYY-MM-DD"))},P=()=>{Y(n(d).add(1,"weeks").format("YYYY-MM-DD"))},F=new Date(k.sdate),R=new Date(k.edate),$=s=>{const t=new Date(s);return t>=F&&t<=R},H=s=>M.some(t=>{const a=n(t.start_date,"YYYY-MM-DD"),r=n(t.end_date,"YYYY-MM-DD"),o=n(s,"YYYY-MM-DD");return console.log("Holiday check: ",{currentDate:o.format("YYYY-MM-DD"),startDate:a.format("YYYY-MM-DD"),endDate:r.format("YYYY-MM-DD")}),o.isBetween(a,r,"day","[]")}),B=(s,t)=>{const a=[...c];a[s]={...a[s],project_id:t,task_id:""},f(a),m("timesheets",a)},q=(s,t)=>{const a=[...c];a[s]={...a[s],task_id:t},f(a),m("timesheets",a)},z=(s,t,a,r)=>{s.preventDefault();const o=[...c];o[t]={...o[t],[a]:r||""},f(o);const u=o.map((i,j)=>({...i,date:x(j%7)}));m("timesheets",u),console.log("Data being sent:",u),D.post("timesheets-store",{preserveScroll:!0,onSuccess:()=>console.log("Timesheets saved successfully"),onError:i=>console.error("There was an error saving the timesheets:",i)})},A=()=>{f([...c,{project_id:"",task_id:"",field1:"",field2:"",field3:"",field4:"",field5:"",field6:"",field7:""}]),p(!1)},b=s=>{s.preventDefault();const t=c.map((a,r)=>({...a,date:x(r%7)}));m("timesheets",t),console.log("Data being sent:",T),m("timesheets",t),_("timesheets-store",{preserveScroll:!0,onSuccess:()=>console.log("Timesheets saved successfully"),onError:()=>console.error("There was an error saving the timesheets")})},G=()=>{const s={total:{},overtime:{}};return["field1","field2","field3","field4","field5","field6","field7"].forEach((t,a)=>{let r=0;c.forEach(o=>{r+=o[t]?parseFloat(o[t]):0}),s.total[t]=r,s.overtime[t]=r===0?0:r-8}),s},J=s=>{const t=n(s).startOf("isoWeek"),a=n(s).endOf("isoWeek");return{start:t,end:a}},K=(s,t)=>{const a=s.format("dddd, MMMM DD, YYYY"),r=t.format("dddd, MMMM DD, YYYY");return`${a} - ${r}`},h=G(),g=J(d),L=K(g.start,g.end);return e.jsxs("div",{className:"px-[8rem]",children:[e.jsx(Q,{user:v}),e.jsx(U,{user_type:N}),e.jsxs("div",{className:"space-x-2",style:{display:"flex",justifyContent:"space-between",margin:"1rem"},children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-bold ",children:"Week"}),": ",e.jsxs("span",{className:"underline text-red-500",children:[" ",L]})]}),e.jsxs("div",{children:[e.jsx("button",{onClick:O,className:"underline",children:e.jsx(V,{className:"text-[2rem] text-blue-500"})}),e.jsx("button",{onClick:P,className:"underline",children:e.jsx(Z,{className:"text-[2rem] text-blue-500"})})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:A,className:"bg-blue-800 p-2 text-white rounded-md ",children:e.jsx(I,{})})}),e.jsxs("table",{className:"w-full mt-3",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#465584] text-white",children:[e.jsx("th",{className:"border",children:"Project"}),e.jsx("th",{className:"border",children:"Task"}),["field1","field2","field3","field4","field5","field6","field7"].map((s,t)=>e.jsxs("th",{children:[n(d).startOf("isoWeek").add(t,"days").format("MMM D"),e.jsx("br",{}),n(d).startOf("isoWeek").add(t,"days").format("ddd")]},t))]})}),e.jsx("tbody",{children:S?e.jsx("tr",{children:e.jsxs("td",{colSpan:"8",children:["   ",e.jsxs("p",{className:"grid place-items-center",children:[" ",e.jsx("h1",{className:"font-bold text-[1.5rem]",children:"We couldn't find any data"}),"Sorry we can't find any timesheet records on this week. Please add timesheet record ."]})]})}):e.jsxs(e.Fragment,{children:[c.map((s,t)=>{var a;return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("select",{className:"bg-[#6699CC] text-white",name:`timesheets[${t}].project_id`,value:s.project_id,onChange:r=>B(t,r.target.value),children:[e.jsx("option",{value:"",children:"Select Project"}),W.map(r=>e.jsx("option",{value:r.id,children:r.project_name},r.id))]})}),e.jsx("td",{children:e.jsxs("select",{className:"bg-[#6699CC] text-white",value:s.task_id,onChange:r=>q(t,r.target.value),children:[e.jsx("option",{value:"",children:"Select Task"}),(a=y[s.project_id])==null?void 0:a.tasks.map(r=>e.jsx("option",{value:r.task_id,children:r.task_name},r.task_id))]})}),["field1","field2","field3","field4","field5","field6","field7"].map((r,o)=>{const u=x(o),i=$(u)||H(u);return console.log(i),e.jsx("td",{className:`form-control  ${i?"border-red-700 border-2":"border"}`,children:e.jsx("input",{type:"text",className:"w-[5rem] border-none",value:s[r]||"",onChange:j=>z(j,t,r,j.target.value),disabled:i})},o)})]},t)}),e.jsxs("tr",{children:[e.jsx("td",{className:"border"}),e.jsx("td",{className:"border font-bold",children:"Total"}),["field1","field2","field3","field4","field5","field6","field7"].map((s,t)=>e.jsx("td",{className:"border p-2",children:h.total[s].toFixed(2)},t))]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border"}),e.jsx("td",{className:"border font-bold",children:"Overtime"}),["field1","field2","field3","field4","field5","field6","field7"].map((s,t)=>e.jsx("td",{className:"border p-2",style:{color:(h.overtime[s]<0,"red")},children:h.overtime[s]!==null?h.overtime[s]>0?`+${h.overtime[s].toFixed(2)}`:h.overtime[s].toFixed(2):"0.00"},t))]})]})})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-3",children:[e.jsx("button",{onClick:b,className:"border-2 p-2 border-[#465584]",children:"Save time Status"}),e.jsx("button",{onClick:b,className:"border-2 p-2 border-[#465584]",children:"Submit time Status"})]})]})};export{le as default};
